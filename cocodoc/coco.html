<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>Coco</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="Author" content="Mike Pall">
<meta name="Copyright" content="Copyright (C) 2005-2008, Mike Pall">
<meta name="Language" content="en">
<link rel="stylesheet" type="text/css" href="bluequad.css" media="screen">
<link rel="stylesheet" type="text/css" href="bluequad-print.css" media="print">
</head>
<body>
<div id="site">
<a href="http://luajit.org/coco.html"><span>Co<span id="logo">Co</span></span></a>
</div>
<div id="head">
<h1>Coco</h1>
</div>
<div id="nav">
<ul><li>
<a class="current" href="coco.html">Coco</a>
<ul><li>
<a href="coco_portability.html">Portability</a>
</li><li>
<a href="coco_api.html">API Extensions</a>
</li><li>
<a href="coco_changes.html">Changes</a>
</li></ul>
</li><li>
<a href="http://luajit.org/download.html">Download <span class="ext">&raquo;</span></a>
</li></ul>
</div>
<div id="main">
<p>
Coco is a small extension to get <strong>True C&nbsp;Coroutine</strong>
semantics for Lua 5.1.
</p>
<p>
Coco is both available as a stand-alone release and integrated
into <a href="http://luajit.org/luajit.html"><span class="ext">&raquo;</span>&nbsp;LuaJIT</a>.
</p>
<p>
The stand-alone release is a patchset against the
<a href="http://www.lua.org/ftp/"><span class="ext">&raquo;</span>&nbsp;standard Lua 5.1.4</a>
distribution. There are no dependencies on LuaJIT. However LuaJIT
depends on Coco to allow yielding for JIT compiled functions.
</p>
<p>
Coco is Copyright &copy; 2004-2008 Mike Pall.
Coco is free software, released under the
<a href="http://www.opensource.org/licenses/mit-license.php"><span class="ext">&raquo;</span>&nbsp;MIT/X license</a>
(same license as the Lua core).
</p>
<h2>Features</h2>
<p>
True C&nbsp;coroutine semantics mean you can yield from a coroutine
across a C&nbsp;call boundary and resume back to it.
</p>
<p>
Coco allows you to use a dedicated C&nbsp;stack for each coroutine.
Resuming a coroutine and yielding from a coroutine automatically switches
C&nbsp;stacks, too.
</p>
<p>
In particular you can now:
</p>
<ul>
<li>Yield across all metamethods (not advised for <tt>__gc</tt>).</li>
<li>Yield across iterator functions (<tt>for x in func do</tt>).</li>
<li>Yield across callbacks (<tt>table.foreach()</tt>, <tt>dofile()</tt>, ...).</li>
<li>Yield across protected callbacks (<tt>pcall()</tt>, <tt>xpcall()</tt>, ...).</li>
<li>Yield from C&nbsp;functions and resume back to them.</li>
</ul>
<p>
Best of all, you don't need to change your Lua or C&nbsp;sources
and still get the benefits. It's fully integrated into the
Lua core, but tries to minimize the required changes.
</p>

<h2>Installation</h2>

<ol>
<li>Fetch the <a href="http://www.lua.org/ftp/lua-5.1.4.tar.gz"><span class="ext">&raquo;</span>&nbsp;Lua 5.1.4</a>
source distribution, unpack it, rename it and cd into it:<br>
<tt>&nbsp;&nbsp;wget http://www.lua.org/ftp/lua-5.1.4.tar.gz</tt><br>
<tt>&nbsp;&nbsp;tar zxf lua-5.1.4.tar.gz</tt><br>
<tt>&nbsp;&nbsp;mv lua-5.1.4 lua-5.1.4-coco</tt><br>
<tt>&nbsp;&nbsp;cd lua-5.1.4-coco</tt><br>
</li>
<li>Patch the sources:<br>
<tt>&nbsp;&nbsp;patch -p1 &lt;../lua-5.1.4-coco-1.1.5.patch</tt><br>
If you don't have "patch" or don't know how to use it, please read
<a href="http://lua-users.org/wiki/LuaPowerPatches"><span class="ext">&raquo;</span>&nbsp;this Wiki page</a>.
</li>
<li>Optionally edit <tt>Makefile</tt>, <tt>src/Makefile</tt>
or <tt>src/luaconf.h</tt>. Please check the
<a href="coco_portability.html">portability requirements</a> for some caveats.
</li>
<li>Run make, supplying your platform as a target. E.g. for Linux:<br>
<tt>&nbsp;&nbsp;make linux</tt><br></li>
<li>Try out some coroutine tests:<br>
<tt>&nbsp;&nbsp;./src/lua ../cocotest/cotest.lua</tt><br>
<tt>&nbsp;&nbsp;./src/lua ../cocotest/cocreate.lua</tt><br>
<tt>&nbsp;&nbsp;./src/lua ../cocotest/comessage.lua</tt><br>
<tt>&nbsp;&nbsp;./src/lua ../cocotest/chameneos.lua</tt><br>
</li>
<li>Optionally install the modified version of Lua:<br>
<tt>&nbsp;&nbsp;make install</tt><br>
</li>
</ol>

<h2>More ...</h2>
<p>
Please visit the <a href="http://luajit.org/download.html"><span class="ext">&raquo;</span>&nbsp;Download</a> page
to fetch the current version of the stand-alone package.
</p>
<p>
Coco needs some machine-specific features &mdash; please have a look
at the <a href="coco_portability.html">Portability Requirements</a>.
</p>
<p>
Coco also provides some upwards-compatible
<a href="coco_api.html">API Extensions</a> for Lua.
</p>
<br class="flush">
</div>
<div id="foot">
<hr class="hide">
Copyright &copy; 2005-2008 Mike Pall
<span class="noprint">
&middot;
<a href="contact.html">Contact</a>
</span>
</div>
</body>
</html>
